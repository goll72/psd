\documentclass[a4paper,12pt]{report}

\usepackage{float}

\usepackage[brazilian]{babel}
\usepackage[T1]{fontenc}

\usepackage{tikz}
\usetikzlibrary{calc,automata,positioning,arrows,shapes}

\usepackage[siunitx]{circuitikz}

\ctikzset{logic ports=ieee}

\title{RelatÃ³rio --- CPU}
\date{\today}

\begin{document}

\maketitle

\begin{figure}[H]
\begin{tikzpicture}[scale=0.8, every node/.style={transform shape}]
	\node[state, minimum size=2cm, initial] (reset) {RESET};
	\node[state, minimum size=2cm, right=of reset] (fetch) {FETCH};
	\node[state, minimum size=2cm, right=of fetch] (store) {STORE};
	
	\node[state, minimum size=2cm, above right=of store] (execute) {\footnotesize EXECUTE};
	\node[state, minimum size=2cm, right=of execute] (poll) {POLL};
	
	\node[state, minimum size=2cm, below right=of store] (fetch_imm) {\small \shortstack{FETCH\\IMM}};
	\node[state, minimum size=2cm, right=of fetch_imm] (store_imm) {\small \shortstack{STORE\\IMM}};

	\draw[->,thick] (reset) edge (fetch)
	          (fetch) edge (store)
	          (store) edge[bend left] (execute)
	          (store) edge[bend right] (fetch_imm)
	          (fetch_imm) edge (store_imm)
	          (store_imm) edge[bend right] (execute)
	          (execute) edge (poll)
	          (poll) edge[out=120,in=60,looseness=3] (poll)
	          (execute) edge[out=90,in=90,out looseness=1,in looseness=2] (fetch)
	          (poll) edge[out=315,in=270,distance=10cm] (fetch.south);
\end{tikzpicture}
\end{figure}

\begin{figure}[H]
\begin{circuitikz}[
	>=Triangle,
	square/.style={regular polygon,regular polygon sides=4},
	abstractic/.style={square,thick,draw,minimum size=2.5cm}
]

	\draw (3,4) node[abstractic] (io) {I/O};
	\draw (0,0) node[abstractic] (cpu) {CPU};
	\draw (6,0) node[abstractic] (mem) {MEM};

	\draw[<->,thick] ([yshift=1em]cpu.east) -- ([yshift=1em]mem.west);
	\draw[->,thick] ([yshift=-1em]cpu.east) -- ([yshift=-1em]mem.west);

	\path (cpu) -- (mem) node[midway] (mid) {};
	
	\draw[->,thick] ([yshift=1em]mid.center) to[short,*-] (io.south);

	\draw[scale=0.8,thick,transform shape] ([yshift=1.25em]cpu.east) ++ (0.2,0) to[multiwire=8] ([yshift=1.25em]mid.center);
\end{circuitikz}
\end{figure}

\begin{figure}[H]
\begin{circuitikz}[
	>=Triangle,
	ic/.style={dipchip,external pins width=0},
	scale=0.6,
	transform shape
]
	\tikzset{ic/.style={
		muxdemux,
		circuitikz/muxdemux/inner label font={},
		circuitikz/muxdemux/outer label font={},
		circuitikz/muxdemux/clock wedge size=0.5,
		circuitikz/muxdemux/inner label xsep=8pt,
		circuitikz/muxdemux/inner label ysep=6pt
	}}

	\tikzset{control_unit/.style={
		ic,
		muxdemux def={Lh=6.5,Rh=6.5,w=6.5,NL=5,NB=2,NR=1},
		draw only left pins={1,3,4},
		muxdemux label={L1=INT,L3=IR,L4=RS,B1=Z,B2=S,R1=CTL}
	}}
	
	\tikzset{reg_file/.style={
		ic,
		muxdemux def={Lh=7.5,Rh=7.5,w=7,NL=5,NT=0,NB=0,NR=2},
		muxdemux label={L1=D,L2=SEL,L3=$\textrm{SEL}_A$,L4=$\textrm{SEL}_B$,L5=$\textrm{WR}_{EN}$,R1=A,R2=B},
	}}

	\tikzset{alu/.style={
		muxdemux,
		muxdemux def={Lh=6.5,Rh=3,NL=2,NR=1,NB=1,w=3,inset w=0.75,inset Lh=1,inset Rh=0}
	}}

	\tikzset{reg/.style={
		flipflop,
		flipflop def={t1=D,t3=$\textrm{WR}_{EN}$,t6=Q}
	}}

	\draw (2,18) node[signal,draw,signal to=east,anchor=east] (int) {\footnotesize INT};
	\draw (2,17) node[signal,draw,signal to=east,anchor=east] (data_bus) {\footnotesize DATA\_BUS};
	\draw (21,-1.5) node[signal,draw,signal to=west] (addr_bus) {\footnotesize ADDR\_BUS};

	\draw (4, 14) node[adder] (pc_adder) {};

	\draw (10,10) node[control_unit] {};

	\coordinate (alu_xpos) at (11,0);
	\draw (7,3) node[reg_file,label={[label distance=8pt]south:REGISTER FILE}] (regs) {};
	
	\draw (regs.rpin 1 -| alu_xpos) node[alu,anchor=lpin 1] (alu) {};

	\draw (regs.rpin 1) edge (alu.lpin 1)
	      (regs.rpin 2) edge (alu.lpin 2);

	\draw (1,10) node[reg,label={[label distance=6pt]south:PC}] (pc) {};
	\draw (1,6) node[reg,label={[label distance=6pt]south:IR}] (ir) {};
	\draw (1,2) node[reg,label={[label distance=6pt]south:RS}] (rs) {};

	\draw (20,14) node[reg,label={[label distance=6pt]south:Z}] (z) {};
	\draw (20,10) node[reg,label={[label distance=6pt]south:S}] (s) {};
	\draw (20,6) node[reg,label={[label distance=6pt]south:C}] (c) {};
	\draw (20,2) node[reg,label={[label distance=6pt]south:O}] (o) {};

	\coordinate (alu_out_xpos) at (16,0);

	\draw (pc.pin 6) -- (pc.pin 6 -| pc_adder.south);
	\draw[->] (pc_adder.south |- pc.pin 6) -- (pc_adder.south); 

	\node at ([yshift=4em]pc_adder.north) {1};
	\draw[->] ([yshift=3em]pc_adder.north) -- (pc_adder.north);

	\coordinate (pc_adder_out_xpos) at (-1.5, 14);

	\draw (pc_adder.west) -- (pc_adder.west -| pc_adder_out_xpos);
	\draw ($(pc_adder.west -| pc_adder_out_xpos)!0.5!(pc_adder_out_xpos |- pc.pin 1)$) 
	      node[buffer port,scale=0.8,anchor=center,rotate=270] (next_pc_tristate) {};

	\draw (pc_adder.west -| pc_adder_out_xpos) -- (next_pc_tristate.in 1);
	\draw (next_pc_tristate.out) -- (pc_adder_out_xpos |- pc.pin 1);
	\draw (pc_adder_out_xpos |- pc.pin 1) to[short,*-] (pc.pin 1);

	\draw (next_pc_tristate.up) -- ($(next_pc_tristate.up) + (0.3,0)$);
	\node[signal,draw,signal to=west,anchor=west] at ($(next_pc_tristate.up) + (0.3,0)$) {\footnotesize CTL\_INCREMENT\_PC};
\end{circuitikz}
\end{figure}

\end{document}
