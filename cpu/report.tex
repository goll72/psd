\documentclass[a4paper,12pt]{report}

\usepackage{float}

\usepackage[brazilian]{babel}
\usepackage[T1]{fontenc}

\usepackage{tikz}
\usetikzlibrary{automata,positioning,arrows,shapes}

\usepackage[siunitx]{circuitikz}

\ctikzset{logic ports=ieee}

\title{RelatÃ³rio --- CPU}
\date{\today}

\begin{document}

\maketitle

\begin{figure}[H]
\begin{tikzpicture}[scale=0.8, every node/.style={transform shape}]
	\node[state, minimum size=2cm, initial] (reset) {RESET};
	\node[state, minimum size=2cm, right=of reset] (fetch) {FETCH};
	\node[state, minimum size=2cm, right=of fetch] (store) {STORE};
	
	\node[state, minimum size=2cm, above right=of store] (execute) {\footnotesize EXECUTE};
	\node[state, minimum size=2cm, right=of execute] (poll) {POLL};
	
	\node[state, minimum size=2cm, below right=of store] (fetch_imm) {\small \shortstack{FETCH\\IMM}};
	\node[state, minimum size=2cm, right=of fetch_imm] (store_imm) {\small \shortstack{STORE\\IMM}};

	\draw[->,thick] (reset) edge (fetch)
	          (fetch) edge (store)
	          (store) edge[bend left] (execute)
	          (store) edge[bend right] (fetch_imm)
	          (fetch_imm) edge (store_imm)
	          (store_imm) edge[bend right] (execute)
	          (execute) edge (poll)
	          (poll) edge[out=120,in=60,looseness=3] (poll)
	          (execute) edge[out=90,in=90,out looseness=1,in looseness=2] (fetch)
	          (poll) edge[out=315,in=270,distance=10cm] (fetch.south);
\end{tikzpicture}
\end{figure}

\begin{figure}[H]
\begin{circuitikz}[
	>=Triangle,
	square/.style={regular polygon,regular polygon sides=4},
	abstractic/.style={square,thick,draw,minimum size=2.5cm}
]

	\draw (3,4) node[abstractic] (io) {I/O};
	\draw (0,0) node[abstractic] (cpu) {CPU};
	\draw (6,0) node[abstractic] (mem) {MEM};

	\draw[<->,thick] ([yshift=1em]cpu.east) -- ([yshift=1em]mem.west);
	\draw[->,thick] ([yshift=-1em]cpu.east) -- ([yshift=-1em]mem.west);

	\path (cpu) -- (mem) node[midway] (mid) {};
	
	\draw[->,thick] ([yshift=1em]mid.center) to[short,*-] (io.south);

	\draw[scale=0.8,thick,transform shape] ([yshift=1.25em]cpu.east) ++ (0.2,0) to[multiwire=8] ([yshift=1.25em]mid.center);
\end{circuitikz}
\end{figure}

\begin{figure}[H]
\begin{circuitikz}[
	>=Triangle,
	ic/.style={dipchip,external pins width=0},
	scale=0.6,
	transform shape
]
	\tikzset{ic/.style={
		muxdemux,
		circuitikz/muxdemux/inner label font={},
		circuitikz/muxdemux/outer label font={},
		circuitikz/muxdemux/clock wedge size=0.5,
		circuitikz/muxdemux/inner label xsep=8pt,
		circuitikz/muxdemux/inner label ysep=6pt
	}}

	\tikzset{control_unit/.style={
		ic,
		muxdemux def={Lh=6.5,Rh=6.5,w=6.5,NL=5,NB=2,NR=1},
		draw only left pins={1,3,4},
		muxdemux label={L1=INT,L3=IR,L4=RS,B1=Z,B2=S,R1=CTL}
	}}
	
	\tikzset{reg_file/.style={
		ic,
		muxdemux def={Lh=7.5,Rh=7.5,w=7,NL=5,NT=0,NB=0,NR=2},
		muxdemux label={L1=D,L2=SEL,L3=$\textrm{SEL}_A$,L4=$\textrm{SEL}_B$,L5=$\textrm{WR}_{EN}$,R1=A,R2=B},
	}}

	\tikzset{alu/.style={
		muxdemux,
		muxdemux def={Lh=6.5,Rh=3,NL=2,NR=1,NB=1,w=3,inset w=0.75,inset Lh=1,inset Rh=0}
	}}

	\tikzset{reg/.style={
		flipflop,
		flipflop def={t1=D,t3=$\textrm{WR}_{EN}$,t6=Q}
	}}

	

	\draw (3,9) node[control_unit] {};

	\coordinate (alu_xpos) at (7,0);
	\draw (3,3) node[reg_file,label={[label distance=8pt]south:REGISTER FILE}] (regs) {};
	
	\draw (regs.rpin 1 -| alu_xpos) node[alu,anchor=lpin 1] (alu) {};

	\draw (regs.rpin 1) edge (alu.lpin 1)
	      (regs.rpin 2) edge (alu.lpin 2);

	\draw (6,9) node[buffer port,scale=0.8] {};
	\draw (9,9) node[reg,label={[label distance=8pt]south:PC}] (pc) {};

	\coordinate (alu_out_xpos) at (12,0);
	\draw (alu.east -| alu_out_xpos) node[signal,draw,signal to=west] {\footnotesize ALU\_OUT};
\end{circuitikz}
\end{figure}

\end{document}
